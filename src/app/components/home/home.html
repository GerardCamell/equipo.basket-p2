<div class="container py-4">
  <h1 class="title text-center">Home works</h1>

  <div *ngIf="matches.length === 0" class="alert alert-info text-center">
    No hay partidos (datos de ejemplo cargados). Usa los botones para crear o simular.
  </div>

  <!-- Resumen partidos -->
  <section class="home-hero mb-3" *ngIf="heroExists; else heroPlaceholder">
    <img src="assets/marcador.jpg" alt="Partido destacado" class="hero-img" loading="lazy">
    <div class="hero-overlay">
      <h2 class="hero-title">Resumen de partidos</h2>
      <p class="hero-sub">Sigue el marcador y controla tu partido favorito</p>
      <button class="btn btn-primary" (click)="scrollToMatches()">Ver partidos</button>
    </div>
  </section>
  <ng-template #heroPlaceholder>
    <div class="home-media my-3 text-center">
      <div class="text-center small text-muted">para ver la imagen destacada</div>
    </div>
  </ng-template>

  <!-- Featured -->
  <div class="featured-card mb-3" *ngIf="matches?.length">
    <div class="featured-main d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center gap-3">
        <img [src]="matches[0].logoHome" alt="{{matches[0].homeTeam}}" class="badge featured-badge" (error)="onLogoError($event, matches[0], 'home')">
        <div class="featured-teams">
          <div class="featured-names">
            <strong>{{matches[0].homeTeam}}</strong>
            <span class="vs-featured">vs</span>
            <strong>{{matches[0].awayTeam}}</strong>
          </div>
          <div class="meta small text-muted">{{ matches[0].quarter }} · {{ formatTime(matches[0].timeSeconds) }}</div>
        </div>
      </div>
      <div class="featured-actions">
        <button class="btn btn-sm btn-light me-2" (click)="openVideo(matches[0])">Ver highlights</button>
        <button class="btn btn-sm btn-outline-light" (click)="focusMatch(matches[0])">Ir al marcador</button>
      </div>
    </div>
  </div>

  <!-- Mini carousel -->
  <div class="mini-carousel mb-3" *ngIf="highlights?.length">
    <div class="slide" *ngFor="let s of highlights; let i = index" [class.active]="i === activeHighlight" (click)="openVideo(s.match)">
      <img [src]="s.thumb" alt="{{s.title}}" class="carousel-thumb" loading="lazy">
      <div class="slide-caption">{{ s.title }}</div>
    </div>
  </div>

  <!-- Grid de partidos -->
  <div class="row g-3 mt-3">
    <div class="col-12 col-md-6 col-lg-4" *ngFor="let m of matches; trackBy: trackById" [attr.data-match-id]="m.id">
      <div class="card match-card h-100">
        <div class="card-body d-flex flex-column">

          <!-- Encabezado y equipos -->
         <div class="d-flex justify-content-between align-items-start">
          <!-- Local -->
          <div class="d-flex align-items-center gap-3 team-block">
          <img *ngIf="m.logoHome" [src]="m.logoHome" alt="{{m.homeTeam}}" class="badge" (error)="onLogoError($event, m, 'home')">
          <div class="team-info">
           <div class="team-name" title="{{ m.homeTeam }}">{{ m.homeTeam }}</div>
           <div class="small text-muted">Local</div>
            </div>
           </div>

              <!-- Centro (quarter/time) -->
              <div class="text-center center-block">
                <div class="quarter">{{ m.quarter }}</div>
                <div class="time small text-muted">{{ formatTime(m.timeSeconds) }}</div>
              </div>

              <!-- Visitante -->
              <div class="d-flex align-items-center gap-3 team-block reverse">
              <div class="team-info text-end">
                  <div class="team-name" title="{{ m.awayTeam }}">{{ m.awayTeam }}</div>
                  <div class="small text-muted">Visitante</div>
                </div>
                <img *ngIf="m.logoAway" [src]="m.logoAway" alt="{{m.awayTeam}}" class="badge" (error)="onLogoError($event, m, 'away')">
              </div>
            </div>

            <!-- Scoreboard -->
            <div class="d-flex align-items-center justify-content-center gap-4 my-3 scoreboard">
            <div class="score text-center">
              <div class="score-number" [class.pulse]="m.animateHome">{{ m.homeScore }}</div>
            </div>
            <div class="vs">-</div>
            <div class="score text-center">
              <div class="score-number" [class.pulse]="m.animateAway">{{ m.awayScore }}</div>
            </div>
          </div>

          <!-- Botones de puntuación -->
          <div class="d-flex gap-2 flex-wrap mt-auto">
            <div class="btn-group">
              <button class="btn btn-sm btn-outline-primary" aria-label="Añadir 1 punto local" (click)="addScore(m,'home',1)">+1 L</button>
              <button class="btn btn-sm btn-outline-primary" aria-label="Añadir 2 puntos local" (click)="addScore(m,'home',2)">+2 L</button>
              <button class="btn btn-sm btn-outline-primary" aria-label="Añadir 3 puntos local" (click)="addScore(m,'home',3)">+3 L</button>
            </div>

            <div class="btn-group ms-2">
              <button class="btn btn-sm btn-outline-secondary" aria-label="Añadir 1 punto visitante" (click)="addScore(m,'away',1)">+1 V</button>
              <button class="btn btn-sm btn-outline-secondary" aria-label="Añadir 2 puntos visitante" (click)="addScore(m,'away',2)">+2 V</button>
              <button class="btn btn-sm btn-outline-secondary" aria-label="Añadir 3 puntos visitante" (click)="addScore(m,'away',3)">+3 V</button>
            </div>
          </div>

          <!-- Controls -->
          <div class="d-flex gap-2 mt-3">
            <button class="btn btn-sm btn-success" (click)="startStop(m)">{{ m.started ? 'Pausa' : 'Iniciar' }}</button>
            <button class="btn btn-sm btn-warning" (click)="resetMatch(m)">Reset</button>
            <button class="btn btn-sm btn-outline-dark ms-auto" (click)="toggleDetail(m)">{{ m.showDetail ? 'Ocultar' : 'Detalle' }}</button>
          </div>

          <!-- Detalle -->
          <div *ngIf="m.showDetail" class="mt-3 small text-muted">
            <div><strong>Cuarto:</strong> {{ m.quarter }}</div>
            <div><strong>Tiempo restante:</strong> {{ formatTime(m.timeSeconds) }}</div>
            <div><strong>ID:</strong> {{ m.id }}</div>
          </div>

          <!-- Mini thumbnail de vídeo (si existe) -->
          <div class="mt-3">
            <div class="video-thumb d-flex align-items-center gap-3" *ngIf="m.videoThumb || m.videoUrl || m.videoLocal">
              <img *ngIf="m.videoThumb" [src]="m.videoThumb" alt="thumb {{m.id}}" class="thumb-img" (click)="openVideo(m)" role="button" loading="lazy" />
              <div class="thumb-info">
                <div class="small text-muted">Resumen / Highlights</div>
                <button class="btn btn-sm btn-outline-primary mt-1" (click)="openVideo(m)">Ver vídeo</button>
              </div>
            </div>
            <div class="small text-muted" *ngIf="!m.videoThumb && !m.videoUrl && !m.videoLocal">No hay video disponible</div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal simple para reproducir vídeo -->
<div class="video-modal" *ngIf="modalOpen" (click)="closeModal($event)">
  <div class="video-modal-content" (click)="$event.stopPropagation()">
    <button class="btn-close" (click)="closeModal($event)" aria-label="Cerrar">&times;</button>

    <!-- Si es video local -->
    <video *ngIf="selectedVideo?.type === 'local'" [src]="selectedVideo?.src" controls autoplay muted class="video-player"></video>

    <!-- Si es YouTube embebido -->
    <iframe *ngIf="selectedVideo?.type === 'youtube'" [src]="selectedVideo?.src" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen class="video-player"></iframe>
  </div>
</div>
